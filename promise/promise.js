"use strict";

// í”„ë¡œë¯¸ìŠ¤ëŠ” ìžë°”ìŠ¤í¬ë¦½íŠ¸ ë‚´ë¶€ì— ë‚´ìž¥ë˜ì–´ ìžˆëŠ” ì˜¤ë¸Œì íŠ¸ì´ë‹¤.
// í”„ë¡œë¯¸ìŠ¤ëŠ” ë¹„ë™ê¸° í†µì‹ ì„ í•  ë•Œ, ì½œë°± í•¨ìˆ˜ ëŒ€ì•ˆìœ¼ë¡œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.

// í”„ë¡œë¯¸ìŠ¤ëŠ” ë”± ë‘ ê°€ì§€ í¬ì¸íŠ¸ë¥¼ ìž¡ê³  ê³µë¶€í•˜ë©´ ë˜ëŠ”ë°
// ì²« ë²ˆì§¸ë¡œ state, ìƒíƒœì´ë‹¤.
// í”„ë¡œì„¸ìŠ¤ê°€ê°€ ë¬´ê±°ìš´ ìž‘ì—… ì‹¤í–‰ ì¤‘ì¸ì§€, ê¸°ëŠ¥ì„ ë‹¤ ìˆ˜í–‰í•˜ê³  ê·¸ê²Œ ì„±ê³µí–ˆëŠ”ì§€ ì‹¤íŒ¨í–ˆëŠ”ì§€
// ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” producer vs ì •ë³´ë¥¼ ì‚¬ìš©í•˜ëŠ” consumers

// 1. state : pending(ì‹¤í–‰ ì¤‘) -> fulfilled(ì„±ê³µ/ì‹¤íŒ¨) or rejected(ë„¤íŠ¸ì›Œí¬ ë¬¸ì œê±°ë‚˜)

// í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì ¸ì„œ ì§€ì •í•œ ìž‘ì—…ì´ ìˆ˜í–‰ ì¤‘ì¼ ë•ŒëŠ” pending ìƒíƒœê°€ ëœë‹¤.

// ì§€ì •í•œ ìž‘ì—…ì´ ëë‚˜ë©´ fulfilled ìƒíƒœ

// ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´ rejected ìƒíƒœ

// Producer vs Consumers

// 1. Producer
// * ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì§ˆ ë•ŒëŠ” ì „ë‹¬í•œ í•¨ìˆ˜ê°€ ë°”ë¡œ ì‹¤í–‰ì´ ëœë‹¤.

const promise = new Promise((resolve, reject) => {
  // ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ ì˜¤ê±°ë‚˜, íŒŒì¼ì—ì„œ í° ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ê±°ë‚˜ í•˜ëŠ” ìž‘ì—…ì´ ë™ê¸°ì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤ë©´, ë‹¤ìŒ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
  // so, ë¹„ë™ê¸°ì ì¸ ì²˜ë¦¬ë¥¼ í•´ì•¼ í•¨. í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìžˆìŒ.
  console.log("doing something...");
  setTimeout(() => {
    // resolve("hyun");
    reject(new Error("no network"));
  }, 2000);
});

// í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í–ˆìœ¼ë‹ˆ, ì´ê²ƒì„ ì´ìš©í•˜ëŠ” Consumersë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

// 2. Consumers : then, catch, finallyë¥¼ ì´ìš©í•´ì„œ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìžˆë‹¤.

promise
  .then((value) => {
    console.log(value);
  })
  // í”„ë¡œë¯¸ìŠ¤ì—ì„œ thenì„ ì´ìš©í•´ì„œ ì„±ê³µì ì¸ ê°’ì„ ë‹¤ë¤˜ë‹¤ë©´
  // catchë¥¼ ì´ìš©í•´ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ, ì–´ë–»ê²Œ í•  ê²ƒì¸ì§€
  .catch((error) => {
    console.log(error);
  })
  .finally(() => {
    console.log("finally");
  });

// finallyëŠ” ë§ˆì§€ë§‰ì— ì„±ê³µ/ì‹¤íŒ¨ ìƒê´€ ì—†ì´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìžˆìŒ.

// í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹
// thenì„ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ í”„ë¡œë¯¸ìŠ¤ê°€ ë¦¬í„´ë˜ê³  ë¦¬í„´ëœ í”„ë¡œë¯¸ìŠ¤ì— catchë¥¼ ë“±ë¡í•˜ëŠ” ê²ƒ.

const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});

fetchNumber
  .then((num) => num * 2)
  .then((num) => num * 3)
  .then((num) => {
    return new Promise((resolve, reject) => {
      setTimeout(() => resolve(num - 1), 1000);
    });
  })
  .then((num) => console.log(num));

// resolveì— ìžˆëŠ” 1ì´ fetchNumberì˜ thenì˜ ì¸ìž numì— ë‹´ê¹€
// num = 1 / num * 2 = 2
// num = 2 / num * 3 = 6
// 6ì´ ì„œë²„ë¡œ ì „ë‹¬ë˜ê³  ìƒˆë¡œìš´ Promiseë¥¼ ë°˜í™˜í•œë‹¤.
// numì— then num (6)ì´ ë‹´ê²¨ì„œ
// 5ê°€ ì¶œë ¥ëœë‹¤
// thenì€ ê°’ì„ ë°”ë¡œ ì „ë‹¬í•  ìˆ˜ë„ ìžˆê³ , í”„ë¡œë¯¸ìŠ¤ë¥¼ ì „ë‹¬í•  ìˆ˜ë„ ìžˆë‹¤.

// 4. Error Handling
const getHen = () =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve("ðŸ”"), 1000);
  });

const getEgg = (hen) =>
  new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`error ${hen} => ðŸ¥š`)), 1000);
  });

const cook = (egg) =>
  new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ðŸ³`), 1000);
  });

getHen() //
  .then(getEgg)
  .catch((error) => {
    return "ë¹µ";
  })
  .then(cook)
  .then(console.log)
  .catch(console.log);

/*
// ES6ë¶€í„° ìžë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í‘œì¤€ ë‚´ìž¥ ê°ì²´ë¡œ ì¶”ê°€ë˜ì—ˆë‹¤.
// ES6ë¥¼ ì§€ì›í•˜ëŠ” ë¸Œë¼ìš°ì €ë‚˜ Node.jsì—ì„œ ì „ì—­ì— ìžˆëŠ” Promiseë¥¼ í™•ì¸í•  ìˆ˜ ìžˆë‹¤.
// */

// /*
// ìƒì„±ìžë¥¼ í†µí•´ì„œ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìžˆë‹¤.
// ìƒì„±ìžì˜ ì¸ìžë¡œ executorë¼ëŠ” í•¨ìˆ˜ë¥¼ ì´ìš©í•œë‹¤.
// */

// new Promise(/*executor*/);

// /*
// executor í•¨ìˆ˜ëŠ” resolveì™€ rejectë¥¼ ì¸ìžë¡œ ê°€ì§„ë‹¤.
// (resolve, reject) => { ... }
// resolveì™€ rejectëŠ” í•¨ìˆ˜ì´ë‹¤.
// resolve(), reject()
// */

// new Promise(/*executor*/ (resolve, reject) => {});

// /*
// ìƒì„±ìžë¥¼ í†µí•´ì„œ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë§Œë“œëŠ” ìˆœê°„ pending (ëŒ€ê¸°) ìƒíƒœê°€ ëœë‹¤.
// */

// new Promise((resolve, reject) => {}); // pending ìƒíƒœ

// /*
// executor í•¨ìˆ˜ ì¸ìž ì¤‘ í•˜ë‚˜ì¸ resolve í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´, fulfilled (ì´í–‰) ìƒíƒœê°€ ëœë‹¤.
// */

// new Promise((resolve, reject) => {
//   resolve(); // resolve í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ fulfilled ìƒíƒœ
// });

// /*
// executor í•¨ìˆ˜ ì¸ìž ì¤‘ í•˜ë‚˜ì¸ reject í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´, rejected (ê±°ë¶€) ìƒíƒœê°€ ëœë‹¤.
// */

// new Promise((resolve, reject) => {
//   reject(); // reject í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ rejected ìƒíƒœ
// });

// /*
// ìƒì„±ìž í•¨ìˆ˜ë¥¼ í†µí•´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë§Œë“¤ë©´, executor í•¨ìˆ˜ë¥¼ ì¸ìžë¡œ ë°›ëŠ”ë‹¤. ë™ì‹œì— pending ìƒíƒœë¡œ ë“¤ì–´ê°€ê²Œ ë˜ê³  ë¹„ë™ê¸° í†µì‹ ì´ ì¼ì–´ë‚˜ê²Œ ë˜ê³  ë¹„ë™ê¸° í†µì‹ ì´ ëë‚¬ì„ ë•Œ ì„±ê³µì ì´ë©´ executor í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ì¸ìž resolveë¥¼ í˜¸ì¶œí•´ì„œ fulfilled ìƒíƒœë¡œ ë§Œë“¤ ìˆ˜ ìžˆë‹¤. rejectëŠ” ê·¸ ë°˜ëŒ€.
// */

// // producer - í”„ë¡œë¯¸ìŠ¤ ê°ì²´ ìƒì„±
// // pë¼ëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ëŠ” 1000ms í›„ì— fufilled ìƒíƒœê°€ ëœë‹¤.
// const p = new Promise((reslove, reject) => {
//   /* pending */
//   setTimeout(() => {
//     resolve(); /* fulfilled */
//   }, 1000);
// });

// // consumer - í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ì´ìš©
// // pë¼ëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ê°€ fulfilled ë˜ëŠ” ì‹œì ì— p.then ì•ˆì— ì„¤ì •í•œ callback í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤.
// p.then(() => {

// })
